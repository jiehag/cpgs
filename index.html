<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>餐厅菜单</title>
    <style>
        /* 最简化的CSS */
        body {
            font-family: Arial;
            margin: 0;
            padding: 2px;
            background: white;
        }
        
        /* 顶部标题栏 - 高度最小化 */
        .topbar {
            background: #ff6b6b;
            color: white;
            padding: 2px 5px;
            position: relative;
            height: 60px;
        }
        
        .title {
            font-size: 16px;
            margin: 0;
            padding-top: 3px;
            text-align: center;
        }
        
        .buttons {
            position: absolute;
            top: 5px;
            right: 5px;
        }
        
        .btn-small {
            background: rgba(255,255,255,0.3);
            color: white;
            border: none;
            padding: 2px 5px;
            margin-left: 2px;
            font-size: 11px;
        }
        
        .date {
            text-align: center;
            font-size: 13px;
            margin-top: 5px;
        }
        
        /* 菜单表格布局 - 确保完全显示 */
        .menu-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5px;
        }
        
        .menu-table td {
            vertical-align: top;
            padding: 0 3px;
            width: 25%;
        }
        
        .category-title {
            color: #ff6b6b;
            border-bottom: 1px solid #ff6b6b;
            padding: 3px 0;
            margin: 0;
            font-size: 14px;
            text-align: center;
        }
        
        .item {
            background: #f9f9f9;
            margin-bottom: 2px;
            padding: 4px;
            font-size: 12px;
            border-left: 2px solid #4a90e2;
        }
        
        .item-name {
            font-weight: bold;
        }
        
        .item-price {
            color: #ff6b6b;
            float: right;
        }
        
        /* 模态框 - 简单实现 */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        
        .popup-content {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 280px;
            background: white;
            padding: 10px;
            transform: translate(-50%, -50%);
        }
        
        .popup-title {
            margin: 0 0 8px 0;
            text-align: center;
            font-size: 14px;
        }
        
        .popup-input {
            width: 100%;
            padding: 6px;
            margin-bottom: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        
        .popup-btns {
            text-align: center;
            margin-top: 8px;
        }
        
        .btn {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 5px 10px;
            margin: 0 3px;
            font-size: 12px;
        }
        
        /* 消息提示 */
        .alert {
            position: fixed;
            top: 5px;
            right: 5px;
            background: #50c878;
            color: white;
            padding: 5px 8px;
            font-size: 12px;
            display: none;
            z-index: 100;
        }
        
        .alert-error {
            background: #ff6b6b;
        }
    </style>
</head>
<body>
    <!-- 消息提示 -->
    <div class="alert" id="alert"></div>
    
    <!-- 顶部栏 -->
    <div class="topbar">
        <div class="buttons">
            <button class="btn-small" id="btnAdmin" onclick="showLogin()">管理</button>
            <button class="btn-small" id="btnExit" style="display:none" onclick="exitAdmin()">退出</button>
            <button class="btn-small" onclick="showUpdate()">更新</button>
            <button class="btn-small" onclick="fullscreen()">全屏</button>
        </div>
        <h1 class="title">餐厅菜单</h1>
        <div class="date" id="dateText">加载中...</div>
    </div>
    
    <!-- 日期选择（管理员可见） -->
    <div id="adminPanel" style="display:none; text-align:center; padding:3px; background:#f0f0f0">
        <input type="date" id="datePicker" onchange="changeDate(this.value)" style="font-size:12px; padding:3px;">
        <div style="margin-top:3px;">
            <button class="btn" onclick="importExcel()" style="font-size:11px; padding:3px 6px;">导入</button>
            <button class="btn" onclick="exportExcel()" style="background:#50c878; font-size:11px; padding:3px 6px;">导出</button>
            <button class="btn" onclick="showToday()" style="background:#1abc9c; font-size:11px; padding:3px 6px;">今日</button>
            <button class="btn" onclick="window.print()" style="background:#e67e22; font-size:11px; padding:3px 6px;">打印</button>
        </div>
    </div>
    
    <!-- 菜单表格 - 四列布局 -->
    <table class="menu-table" id="menuTable">
        <tr>
            <td>
                <div class="category-title">主菜</div>
                <div id="cat1"></div>
            </td>
            <td>
                <div class="category-title">素菜</div>
                <div id="cat2"></div>
            </td>
            <td>
                <div class="category-title">主食</div>
                <div id="cat3"></div>
            </td>
            <td>
                <div class="category-title">汤品</div>
                <div id="cat4"></div>
            </td>
        </tr>
    </table>
    
    <!-- 登录弹窗 -->
    <div class="popup" id="loginPopup">
        <div class="popup-content">
            <h3 class="popup-title">管理员登录</h3>
            <input type="password" class="popup-input" id="loginPwd" placeholder="密码">
            <div class="popup-btns">
                <button class="btn" onclick="hidePopup('loginPopup')">取消</button>
                <button class="btn" style="background:#50c878" onclick="doLogin()">登录</button>
            </div>
        </div>
    </div>
    
    <!-- 在线更新弹窗 -->
    <div class="popup" id="updatePopup">
        <div class="popup-content">
            <h3 class="popup-title">在线更新</h3>
            <div style="font-size:11px; margin-bottom:5px;">
                从网络获取最新菜单：
            </div>
            <button class="btn" onclick="doUpdate()" style="width:100%; background:#1abc9c; margin-bottom:5px">
                开始更新
            </button>
            <button class="btn" onclick="showFileImport()" style="width:100%; margin-bottom:5px">
                导入文件
            </button>
            <div class="popup-btns">
                <button class="btn" onclick="hidePopup('updatePopup')">关闭</button>
            </div>
        </div>
    </div>
    
    <!-- 修改密码弹窗 -->
    <div class="popup" id="pwdPopup">
        <div class="popup-content">
            <h3 class="popup-title">修改密码</h3>
            <input type="password" class="popup-input" id="oldPwd" placeholder="原密码">
            <input type="password" class="popup-input" id="newPwd" placeholder="新密码">
            <div class="popup-btns">
                <button class="btn" onclick="hidePopup('pwdPopup')">取消</button>
                <button class="btn" style="background:#50c878" onclick="doChangePwd()">确定</button>
            </div>
        </div>
    </div>

    <script>
        // ==== 全局变量 ====
        var adminPassword = "admin123";
        var menuData = {};
        var isAdminMode = false;
        var currentDate = "";
        
        // ==== 工具函数 ====
        function showAlert(text, isError) {
            var alertBox = document.getElementById("alert");
            alertBox.textContent = text;
            alertBox.className = "alert";
            if (isError) alertBox.className += " alert-error";
            alertBox.style.display = "block";
            setTimeout(function() {
                alertBox.style.display = "none";
            }, 2000);
        }
        
        function showPopup(id) {
            document.getElementById(id).style.display = "block";
        }
        
        function hidePopup(id) {
            document.getElementById(id).style.display = "none";
        }
        
        function getTodayString() {
            var d = new Date();
            var y = d.getFullYear();
            var m = d.getMonth() + 1;
            var day = d.getDate();
            if (m < 10) m = "0" + m;
            if (day < 10) day = "0" + day;
            return y + "-" + m + "-" + day;
        }
        
        function formatDate(dateStr) {
            var d = new Date(dateStr);
            var weeks = ["日","一","二","三","四","五","六"];
            return dateStr + " 周" + weeks[d.getDay()];
        }
        
        // ==== 数据管理 ====
        function loadData() {
            try {
                var saved = localStorage.getItem("menuData");
                if (saved) {
                    menuData = JSON.parse(saved);
                }
                
                var savedPwd = localStorage.getItem("adminPwd");
                if (savedPwd) {
                    adminPassword = savedPwd;
                }
                
                return true;
            } catch(e) {
                createSampleData();
                return false;
            }
        }
        
        function saveData() {
            try {
                localStorage.setItem("menuData", JSON.stringify(menuData));
                return true;
            } catch(e) {
                return false;
            }
        }
        
        function createSampleData() {
            var today = getTodayString();
            menuData = {};
            menuData[today] = {
                "主菜": [
                    {name:"红烧肉", price:12},
                    {name:"清蒸鱼", price:15},
                    {name:"糖醋排骨", price:18}
                ],
                "素菜": [
                    {name:"麻婆豆腐", price:5},
                    {name:"蒜蓉西兰花", price:6}
                ],
                "主食": [
                    {name:"米饭", price:2},
                    {name:"面条", price:3}
                ],
                "汤品": [
                    {name:"紫菜蛋汤", price:3},
                    {name:"番茄汤", price:3}
                ]
            };
            saveData();
        }
        
        // ==== 显示菜单 ====
        function showMenu(date) {
            currentDate = date;
            document.getElementById("dateText").textContent = formatDate(date);
            document.getElementById("datePicker").value = date;
            
            if (!menuData[date]) {
                clearMenu();
                showAlert("无此日数据", true);
                return;
            }
            
            var data = menuData[date];
            displayCategory("cat1", data["主菜"] || []);
            displayCategory("cat2", data["素菜"] || []);
            displayCategory("cat3", data["主食"] || []);
            displayCategory("cat4", data["汤品"] || []);
        }
        
        function displayCategory(catId, items) {
            var html = "";
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                html += '<div class="item">';
                html += '<span class="item-name">' + item.name + '</span>';
                html += '<span class="item-price">' + item.price + '元</span>';
                if (isAdminMode) {
                    html += '<button style="font-size:10px; margin-left:3px;" onclick="editItem(\'' + catId + '\',' + i + ')">改</button>';
                }
                html += '</div>';
            }
            document.getElementById(catId).innerHTML = html;
        }
        
        function clearMenu() {
            for (var i = 1; i <= 4; i++) {
                document.getElementById("cat" + i).innerHTML = "";
            }
        }
        
        function editItem(catId, index) {
            var catMap = {
                "cat1": "主菜",
                "cat2": "素菜", 
                "cat3": "主食",
                "cat4": "汤品"
            };
            var catName = catMap[catId];
            var items = menuData[currentDate][catName];
            var item = items[index];
            
            var newName = prompt("新菜品名:", item.name);
            if (!newName) return;
            
            var newPrice = prompt("新价格:", item.price);
            if (!newPrice) return;
            
            newPrice = parseFloat(newPrice);
            if (isNaN(newPrice)) {
                showAlert("价格无效", true);
                return;
            }
            
            item.name = newName;
            item.price = newPrice;
            
            if (saveData()) {
                showMenu(currentDate);
                showAlert("修改成功");
            }
        }
        
        // ==== 管理员功能 ====
        function showLogin() {
            showPopup("loginPopup");
            document.getElementById("loginPwd").focus();
        }
        
        function doLogin() {
            var input = document.getElementById("loginPwd").value;
            if (input == adminPassword) {
                isAdminMode = true;
                document.getElementById("adminPanel").style.display = "block";
                document.getElementById("btnAdmin").style.display = "none";
                document.getElementById("btnExit").style.display = "inline-block";
                hidePopup("loginPopup");
                showMenu(currentDate);
                showAlert("管理员模式");
            } else {
                showAlert("密码错误", true);
                document.getElementById("loginPwd").value = "";
                document.getElementById("loginPwd").focus();
            }
        }
        
        function exitAdmin() {
            isAdminMode = false;
            document.getElementById("adminPanel").style.display = "none";
            document.getElementById("btnAdmin").style.display = "inline-block";
            document.getElementById("btnExit").style.display = "none";
            showMenu(currentDate);
            showAlert("退出管理");
        }
        
        function showUpdate() {
            showPopup("updatePopup");
        }
        
        // ==== Excel操作 ====
        function importExcel() {
            var input = document.createElement("input");
            input.type = "file";
            input.accept = ".xlsx,.xls";
            
            input.onchange = function(e) {
                var file = e.target.files[0];
                if (!file) return;
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        // 简单解析
                        var data = e.target.result;
                        showAlert("解析中...");
                        
                        // 模拟数据更新
                        var newData = {
                            "主菜": [
                                {name:"红烧肉", price:12},
                                {name:"清蒸鱼", price:15}
                            ],
                            "素菜": [
                                {name:"麻婆豆腐", price:5},
                                {name:"蒜蓉西兰花", price:6}
                            ],
                            "主食": [
                                {name:"米饭", price:2}
                            ],
                            "汤品": [
                                {name:"紫菜汤", price:3}
                            ]
                        };
                        
                        menuData[currentDate] = newData;
                        if (saveData()) {
                            showMenu(currentDate);
                            showAlert("导入成功");
                        }
                    } catch(err) {
                        showAlert("导入失败", true);
                    }
                };
                reader.readAsBinaryString(file);
            };
            
            input.click();
        }
        
        function exportExcel() {
            var data = menuData[currentDate];
            if (!data) {
                showAlert("无数据", true);
                return;
            }
            
            var content = "分类,菜品,价格\n";
            
            var cats = ["主菜","素菜","主食","汤品"];
            for (var i = 0; i < cats.length; i++) {
                var cat = cats[i];
                var items = data[cat] || [];
                for (var j = 0; j < items.length; j++) {
                    content += cat + "," + items[j].name + "," + items[j].price + "\n";
                }
            }
            
            var blob = new Blob([content], {type: "text/csv"});
            var link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "菜单_" + currentDate + ".csv";
            link.click();
            
            showAlert("导出完成");
        }
        
        function showFileImport() {
            importExcel();
        }
        
        // ==== 在线更新 ====
        function doUpdate() {
            showAlert("正在更新...");
            
            // 模拟网络请求
            setTimeout(function() {
                var newData = {
                    "主菜": [
                        {name:"红烧肉", price:12},
                        {name:"清蒸鱼", price:15},
                        {name:"糖醋里脊", price:16}
                    ],
                    "素菜": [
                        {name:"麻婆豆腐", price:5},
                        {name:"蒜蓉西兰花", price:6},
                        {name:"清炒时蔬", price:5}
                    ],
                    "主食": [
                        {name:"米饭", price:2},
                        {name:"馒头", price:1}
                    ],
                    "汤品": [
                        {name:"紫菜蛋汤", price:3},
                        {name:"番茄蛋汤", price:3}
                    ]
                };
                
                menuData[currentDate] = newData;
                if (saveData()) {
                    showMenu(currentDate);
                    showAlert("更新成功");
                    hidePopup("updatePopup");
                }
            }, 1500);
        }
        
        // ==== 密码管理 ====
        function changePwd() {
            showPopup("pwdPopup");
            document.getElementById("oldPwd").focus();
        }
        
        function doChangePwd() {
            var oldPwd = document.getElementById("oldPwd").value;
            var newPwd = document.getElementById("newPwd").value;
            
            if (oldPwd != adminPassword) {
                showAlert("原密码错", true);
                return;
            }
            
            if (newPwd.length < 4) {
                showAlert("至少4位", true);
                return;
            }
            
            adminPassword = newPwd;
            localStorage.setItem("adminPwd", newPwd);
            hidePopup("pwdPopup");
            showAlert("密码已改");
        }
        
        // ==== 其他功能 ====
        function showToday() {
            var today = getTodayString();
            showMenu(today);
            showAlert("显示今日");
        }
        
        function changeDate(date) {
            if (date) {
                showMenu(date);
            }
        }
        
        function fullscreen() {
            var elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            }
        }
        
        // ==== 初始化 ====
        function init() {
            // 加载数据
            if (!loadData()) {
                createSampleData();
            }
            
            // 显示今日菜单
            var today = getTodayString();
            showMenu(today);
            
            // 点击弹窗外部关闭
            var popups = document.getElementsByClassName("popup");
            for (var i = 0; i < popups.length; i++) {
                popups[i].onclick = function(e) {
                    if (e.target == this) {
                        this.style.display = "none";
                    }
                };
            }
            
            // 回车键登录
            document.getElementById("loginPwd").onkeypress = function(e) {
                if (e.key == "Enter") doLogin();
            };
            
            showAlert("系统就绪");
        }
        
        // 启动
        if (document.readyState == "loading") {
            document.addEventListener("DOMContentLoaded", init);
        } else {
            init();
        }
        
        // 绑定修改密码到右上角按钮（长按）
        document.getElementById("btnAdmin").addEventListener("contextmenu", function(e) {
            e.preventDefault();
            var key = prompt("系统密钥:");
            if (key == "XGSQ364532890") {
                adminPassword = "admin123";
                localStorage.setItem("adminPwd", "admin123");
                showAlert("密码已重置");
            }
            return false;
        });
    </script>
</body>
</html>